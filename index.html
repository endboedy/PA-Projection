<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Order Collapse</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 12px; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #999; padding: 4px; text-align: left; }
    th { background: #eee; }
    .action-text { color: blue; cursor: pointer; margin-right: 6px; }
    .sub-row { background: #f9f9f9; }
    .toggle-sub { cursor: pointer; font-weight: bold; margin-right: 5px; }
  </style>
</head>
<body>

<h2>Work Order with Collapse/Expand</h2>
<div id="tables"></div>

<script>
let dataByCategory = {
  "Loading": [
    { 
      no: 1, equipment: "Excavator A", description: "Main unit", down: "08:00", up: "12:00", order: "ORD-123", remarks: "OK",
      collapsed: false,
      items: [
        {equipment:"Bucket", description:"Crack", order:"ORD-123-1", remarks:"Replace"},
        {equipment:"Hydraulic", description:"Leak", order:"ORD-123-2", remarks:"Check"}
      ]
    },
    { 
      no: 2, equipment: "Loader B", description: "Main unit", down: "09:00", up: "13:00", order: "ORD-456", remarks: "Delay",
      collapsed: false,
      items: []
    }
  ]
};

// render semua tabel
function renderAllTables() {
  const container = document.getElementById("tables");
  container.innerHTML = "";
  for (const category in dataByCategory) {
    const table = document.createElement("table");
    let html = `<tr>
      <th>No</th><th></th><th>Equipment</th><th>Description</th>
      <th>Down Time</th><th>Up Time</th><th>Order</th><th>Remarks</th><th>Action</th>
    </tr>`;

    dataByCategory[category].forEach(entry => {
      html += `<tr>
        <td>${entry.no}</td>
        <td><span class="toggle-sub" onclick="toggleSub('${category}',${entry.no})">${entry.collapsed ? '[+]' : '[-]'}</span></td>
        <td>${entry.equipment}</td>
        <td>${entry.description}</td>
        <td>${entry.down}</td>
        <td>${entry.up}</td>
        <td>${entry.order}</td>
        <td>${entry.remarks}</td>
        <td>
          <span class="action-text" onclick="addSubItem('${category}',${entry.no})">Add Sub</span>
        </td>
      </tr>`;

      // render sub jika tidak collapsed
      if (!entry.collapsed) {
        entry.items.forEach((sub, idx) => {
          html += `<tr class="sub-row">
            <td>${entry.no}.${idx+1}</td>
            <td></td>
            <td>${sub.equipment}</td>
            <td>${sub.description}</td>
            <td></td>
            <td></td>
            <td>${sub.order}</td>
            <td>${sub.remarks}</td>
            <td>
              <span class="action-text" onclick="deleteSub('${category}',${entry.no},${idx})">Delete</span>
            </td>
          </tr>`;
        });
      }
    });

    table.innerHTML = <caption><b>${category}</b></caption> + html;
    container.appendChild(table);
  }
}

function toggleSub(category,no){
  const entry = dataByCategory[category].find(d=>d.no===no);
  if(entry){
    entry.collapsed = !entry.collapsed;
    renderAllTables();
  }
}

function addSubItem(category,no){
  const entry = dataByCategory[category].find(d=>d.no===no);
  if(entry){
    entry.items.push({
      equipment:"", description:"", order:"", remarks:""
    });
    renderAllTables();
  }
}

function deleteSub(category,no,idx){
  const entry = dataByCategory[category].find(d=>d.no===no);
  if(entry){
    entry.items.splice(idx,1);
    renderAllTables();
  }
}

renderAllTables();
</script>

</body>
</html>
